# Лекция #1
## Цели занятия
понимать вопросы и проблемы обслуживания и сопровождения, которые важно учесть на этапе проектирования;

## Краткое содержание
История развития БД
Различные БД

### SQL
* Oracle Database
* Microsoft SQL
* Maria DB
* MySQL
* PostgreSQL

### NoSQL
* MongoDB
* Cassandra
* Elasticsearch
* Tarantool
* Redis
* ClickHouse

### NewSQL

* Amazon Aurora
* Google Spanner
* CockroachDB
* BigQuery

## Реляционная модель

### История реляционной модели.

* начало 1970-х
* основоположник Эдгар Франк Кодд (Edgar Frank
Codd)
* в рамках программы исследований IBM
В 1970 издал работу «A Relational Model of Data for
Large Shared Data Banks», которая считается первой
работой по реляционной модели данных
* NULL, view, нормализация, select и т.д.
* позднее предложил «12 правил Кодда»

https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%B4%D0%B4,_%D0%AD%D0%B4%D0%B3%D0%B0%D1%80

* данные представлены в виде кортежей
(tuples)
* объединенных в отношения (relations)
* декларативный способ представления
данных и запросов
* пользователь пишет запрос на понятном
ему языке
* позволяя СУБД выполнить всю работу по
* обработке этих запросов

## DML - modification
* SELECT
* INSERT
* UPDATE
* DELETE
* DDL - definition
* ALTER
* CREATE
* DROP
* DCL - control
* GRANT
* REVOKE

### современных реалиях еще и DQL && TCL
  SQL constraints
* правила описывающие корректность данных
* работают на уровне DML
* любимы DBA
* не любимы разработчиками
* давайте им имена уж если вы их используете
* PRIMARY KEY
* FOREIGN KEY
* UNIQUE
* CHECK

## Уровни проектирования
* Концептуальная модель
* Определение сущностей и их документирование (по полю comment)
    http://dbdoc.sourceforge.net/
* Определение связей между сущностями 
* Создание ER-модель
* Определение атрибутов
* Определение потенциальных ключей (набор записей, делающих запись
    уникальной)

## Сущность (entity) – это реальный или представляемый тип объекта,
информация о котором должна сохраняться и быть доступна.
Связь (relationship) – это графически изображаемая ассоциация,
устанавливаемая между двумя сущностями. Связь может существовать между
двумя разными сущностями или между сущностью и ей же самой (рекурсивная
связь). Возможны связи на основе отношений:
* один-к-одному;
* один-ко-многим;
* многие-ко-многим.
Связь может быть задана ограничением в виде FOREIGN KEY

## Типы сущностей:
Справочник – редко изменяемые или пополняемые данные. Используются как
описание атрибутов других сущностей (напр. страна проживания)
Оперативные данные - В большинстве случаев рабочие транзакционные
данные (покупки, игровые сессии, логи). Изменение таких данных часто
запрещено. Удаление тоже.
Расчетные данные, кэши - данные получаемые в результате операций над
существующими данными. Могут быть пересчитаны

# Логическая модель
* Выбор модели данных (SQL, NoSQL, newSQL)
* Определение набор таблиц
* Декомпозиция
* Нормализация данных
* Денормализация данных (избыточность, например materialized view)
* Определения набора транзакций и соответствие структуры данных
* Определение требований поддержки целостности
* Создание окончательной логической модели и обсуждение ее с командой и заказчиками

# Физическая модель
* Проектирование таблиц данных средствами выбранной СУБД
* Даже в рамках одной СУБД есть разница в движках (не во всех субд), видах индексов и т.д.
* Реализация бизнес правил в выбранной СУБД
* Хранимые процедуры как на SQL, так и на других языках в конкретной СУБД
* Определение транзакционной модели
* Проектирование физической организации данных
* Планирование ресурсов (pool connect, proxy)
* Определение правил безопасности и защиты информации
* Организация сопровождения и мониторинга

### Выбор структуры хранения:
* монолит
* кластер
* шарды
* распределенная сеть
* облако
### Оценка:
* нагрузки
* роста обьема данных и коннектов
* производительности
* Определение требований к производительности
* Организация резервного копирования
* Обеспечения высокой доступности
* Организация непрерывной доставки Что такое CI/CD? Разбираемся с непрерывной интеграцией и непрерывной поставкой / Хабр 
* Множественная параллельная нагрузка

### ACID, MVCC, ARIES
## Множественная параллельная нагрузка
* Реляционная теория и SQL позволяет абстрагироваться от конкретной
* реализации СУБД, но есть одна непростая проблема
* как обеспечить параллельную работу множества сессий (concurrency) ?
* которые модифицируют данные
* так чтобы они не мешали друг другу
* ни с точки зрения чтения ни с точки зрения записи
* и обеспечивали целостность данных - т.н. consistency
* и их надежность - т.н. durability

## ACID
ответ - транзакционные системы, OLTP - Online Transaction Processing
ACID
• Atomicity — Атомарность
• Consistency — Согласованность
• Isolation — Изолированность
• Durability — Долговечность
транзакция (transaction) - называется множество операций, выполняемое
приложением:
• выполняется полностью и переводит базу данных из одного корректного
состояния в другое корректное состояние (согласованность) или отменяется
• при условии, что транзакция выполнена полностью (атомарность)
• и без помех со стороны других транзакций (изолированность)

## ACID
ARIES - Algorithms for Recovery and Isolation Exploiting Semantics
• logging
• undo
• redo
• checkpoints
MVCC - Multiversion Concurrency Control
• copy-on-write
• каждый пользователь работает со снимком БД
• вносимые пользователем изменения не видны другим до фиксации транзакции

## Резервное копирование

## Масштабирование

## Репликация
Процесс синхронизации данных путем доставки данных на другие ноды:
● Задачи: балансировка чтения/записи (Master-Master, Master-Slave), fault
tolerance
● Проблемы: организация автоматического переключения
● Разновидности:
○ Асинхронная
○ Синхронная
○ Полусинхронная
● Метод доставки - журналы (REDO logs, WAL, transactional logs)

## Кластеризация

Полноценная масштабируемая, отказоустойчивая конфигурация на основе
репликации:
● Мастер-слейв, Мастер-мастер
● MySQL: Galera cluster, InnoDB cluster, XtraDB Cluster, NDB Cluster
● PostgreSQL: Patroni, Slony
● Redis Cluster
● Mongo Sharded Cluster

## Шардирование

## Секционирование

## Результаты
осознание задач, стоящих перед проектировщиком БД и путей их решения.

## Преподаватель
Евгений Аристов

## Дата и время
29 августа, вторник в 20:00
Длительность занятия: 90 минут
Опрос
Пожалуйста, пройдите опрос о занятии
