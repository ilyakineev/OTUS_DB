# Лекция #4

## Теорема CAP

## Цели занятия

* Понимать смысл теоремы CAP;
* Различать BASE и ACID требования к базам;
* Понимать проблему выбора СУБД;

### ACID

ACID (Atomicity, Consistency, Isolation, Durability) - это набор характеристик, обеспечивающих надежность транзакций в
базах данных. Эти характеристики обеспечивают целостность данных и устойчивость к сбоям, что крайне важно для
поддержания надежности информации в базах данных.

### Вот краткое описание каждой из характеристик ACID:

1. Atomicity (Атомарность): Транзакция считается атомарной, если она выполняется целиком или не выполняется вообще. То
   есть, если в ходе выполнения транзакции происходит какая-либо ошибка, все изменения, сделанные до этого момента,
   откатываются, и база данных остается в непротиворечивом состоянии.

2. Consistency (Согласованность): Эта характеристика гарантирует, что транзакция приводит базу данных из одного
   согласованного состояния в другое. Если данные в базе данных находятся в согласованном состоянии до начала
   транзакции, они также будут в согласованном состоянии после ее завершения.

3. Isolation (Изоляция): Это принцип обеспечивает, что результаты выполняемых параллельно транзакций будут такими же,
   как если бы они выполнялись последовательно. Изоляция предотвращает конфликты между транзакциями, такие как чтение
   данных, которые одна транзакция изменяет, но еще не сохранила.

4. Durability (Устойчивость): Когда транзакция завершена успешно, ее результаты сохраняются и становятся неподвижными
   даже в случае сбоя системы. Это обеспечивает, что данные, подтвержденные транзакцией, останутся в базе данных даже
   при возможных сбоях аппаратного обеспечения или программного обеспечения.

ACID-свойства являются фундаментальными для поддержания надежности и целостности данных в системах управления базами
данных (СУБД). Однако, в некоторых случаях, строгая соблюдение всех ACID-свойств может привести к уменьшению
производительности, поэтому в некоторых системах выбирают более гибкий подход, такой как BASE (Basically Available, Soft
state, Eventually consistent).

### Проблемы с традиционными базами;

Традиционные реляционные базы данных, несмотря на свою популярность и распространенность, имеют свои ограничения и
проблемы. Вот несколько из них:

1. Масштабируемость: Реляционные базы данных могут столкнуться с трудностями в масштабировании горизонтально (по
   добавлению новых серверов), особенно при обработке больших объемов данных или большого числа одновременных запросов.
   Вертикальное масштабирование (по увеличению мощности отдельного сервера) имеет свои ограничения.
2. Гибкость схемы данных: В реляционных базах данных схема данных обычно должна быть строго определена заранее. Это
   может стать проблемой, когда требуется изменение структуры данных в ответ на изменяющиеся бизнес-требования.
3. Сложность запросов: Сложные запросы в реляционных базах данных могут быть трудными для оптимизации, особенно если они
   включают соединения нескольких таблиц или агрегатные функции. Это может привести к снижению производительности.
4. Отсутствие поддержки для некоторых типов данных: Реляционные базы данных могут не поддерживать эффективно некоторые
   типы данных, такие как документы JSON или графовые структуры данных, что ограничивает их способность эффективно
   обрабатывать разнообразные данные.
5. Неэффективность при частых записях и чтениях: В некоторых сценариях, где требуется частое чтение и запись данных,
   реляционные базы данных могут оказаться не самым эффективным выбором.
6. Сложность горизонтального масштабирования: Горизонтальное масштабирование (добавление новых узлов кластера) может
   быть сложным для реализации в реляционных базах данных без использования сложных технологий разделения данных.
7. Высокие накладные расходы на поддержание ACID-свойств: ACID-свойства, обеспечивающие надежность транзакций, могут
   вызывать дополнительные накладные расходы на производительность в случае высоких нагрузок.

В ответ на эти ограничения и вызовы были разработаны новые типы баз данных, такие как NoSQL (Not Only SQL), которые
стремятся предоставить более гибкое и эффективное решение для различных видов данных и сценариев использования.

### Partition tolerance и CAP;

CAP-теорема (теорема Брюера) является концептуальным фреймворком, описывающим взаимосвязь трех основных свойств системы
распределенных данных: Consistency (Согласованность), Availability (Доступность) и Partition tolerance (Устойчивость к
разделению).

* Consistency (C) - Согласованность: Это означает, что все узлы в распределенной системе видят одинаковые данные в
  одинаковый момент времени. Если изменения в системе произошли, все узлы увидят эти изменения в одинаковом порядке.

* Availability (A) - Доступность: Это означает, что каждый запрос к системе завершается успешно, не возвращая ошибок. В
  контексте CAP-теоремы доступность означает, что каждый запрос получает ответ, не обязательно самый последний, а просто
  какой-то ответ.

* Partition tolerance (P) - Устойчивость к разделению: Это означает, что система продолжает функционировать, даже если
  происходит разделение (потеря связи) между некоторыми узлами системы. Устойчивость к разделению является неизбежной в
  распределенных системах, где сетевые сбои могут происходить.

CAP-теорема утверждает, что в распределенной системе можно обеспечить только два из трех свойств (Consistency,
Availability, Partition tolerance) одновременно. Если система сталкивается с сетевым разделением (Partition tolerance),
она должна выбрать между согласованностью (Consistency) и доступностью (Availability).

Иными словами:

* CP (Consistency/Partition tolerance): Система обеспечивает согласованность в ущерб доступности в случае разделения.

* CA (Consistency/Availability): Система обеспечивает согласованность и доступность, но не обязательно устойчивость к
  разделению. В случае разделения она может отказать в обслуживании или возвратить устаревшие данные.

* AP (Availability/Partition tolerance): Система обеспечивает доступность в ущерб согласованности. Это означает, что она
  продолжает обслуживать запросы, даже если не может гарантировать, что все узлы видят одни и те же данные в одинаковый
  момент времени.

Выбор между CP, CA и AP зависит от конкретных требований и характеристик приложения. Различные системы баз данных и
хранилища данных могут стремиться к разным компромиссам, в зависимости от их целей и применения.

### BASE

* BASE (Basically Available, Soft state, Eventually consistent) - это подход к построению распределенных систем и баз
  данных, который предлагает более гибкую альтернативу классической ACID-модели. В отличие от ACID, BASE ориентирован на
  обеспечение высокой доступности и гибкости при работе с распределенными и масштабируемыми системами. Вот основные
  принципы BASE:
* Basically Available (Основная доступность): Этот принцип предполагает, что система всегда готова обслуживать запросы,
  даже в случае возникновения сбоев или разделений в сети. Это отличается от строгой доступности в ACID, где доступность
  может быть компрометирована в случае сбоев.
* Soft state (Мягкое состояние): В системах, следующих принципу BASE, состояние данных может временно быть
  несогласованным между узлами системы. В отличие от строгой согласованности в ACID, BASE допускает временное
  расхождение данных между узлами. Это позволяет системе быть более отзывчивой и гибкой в условиях распределенной среды.
* Eventually Consistent (В конечном итоге согласованная): Этот принцип предполагает, что если система находится в
  нормальном состоянии (без разделения сети и других сбоев), то в конечном итоге все копии данных в системе будут
  согласованы. Таким образом, система постепенно возвращается к согласованному состоянию после того, как были устранены
  сетевые разделения и другие асинхронные факторы.

BASE подход часто используется в распределенных базах данных NoSQL, таких, как Cassandra и Couchbase, где высокая
доступность и гибкость считаются более важными, чем строгая согласованность данных в реальном времени. Этот подход
особенно подходит для приложений, где возможны временные расхождения данных, и важнее быстрая доступность и
масштабируемость.