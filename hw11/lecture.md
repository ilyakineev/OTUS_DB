# Лекция #11

## Типы данных в PostgreSQL

## Многообразие типов данных в PostgreSQL

PostgreSQL - это мощная открытая объектно-реляционная система управления базами данных (ORDBMS), которая поддерживает
широкий спектр типов данных для хранения и обработки различных видов информации. Вот несколько основных типов данных в
PostgreSQL:

1. **Целочисленные типы данных:**
    - `smallint` - 2-байтовое целое число.
    - `integer` - 4-байтовое целое число.
    - `bigint` - 8-байтовое целое число.

2. **Типы данных с плавающей точкой:**
    - `real` - 4-байтовое число с плавающей точкой.
    - `double precision` - 8-байтовое число с плавающей точкой.

3. **Символьные типы данных:**
    - `character(n)` - фиксированная длина строки.
    - `varchar(n)` - строка переменной длины с максимальной длиной n.
    - `text` - строка переменной длины без ограничения размера.

4. **Типы данных для работы с датами и временем:**
    - `timestamp` - дата и время с точностью до микросекунд.
    - `date` - только дата без времени.
    - `time` - только время без даты.

5. **Логический тип данных:**
    - `boolean` - принимает значения `true` или `false`.

6. **Другие встроенные типы:**
    - `money` - денежная сумма.
    - `bytea` - массив байтов.
    - `uuid` - уникальный идентификатор.

7. **Массивы:**
    - В PostgreSQL есть поддержка массивов для многих типов данных. Например, `integer[]` - массив целых чисел.

8. **JSON и JSONB:**
    - `json` - для хранения данных в формате JSON.
    - `jsonb` - для хранения бинарных представлений JSON с более эффективным индексированием и поиском.

9. **Географические и геометрические типы:**
    - `point` - точка в пространстве.
    - `line` - линия.
    - `polygon` - многоугольник.
    - `circle` - круг.

Это лишь краткий обзор многообразия типов данных в PostgreSQL. Эта база данных предоставляет множество возможностей для
работы с данными различных типов, что делает ее гибкой и мощной для разнообразных приложений.

## Встроенные функции для работы с типами данных в PostgreSQL

PostgreSQL предоставляет множество встроенных функций для работы с различными типами данных. Вот несколько примеров:

1. **Текстовые функции:**
    - `LENGTH(str)` - возвращает длину строки `str`.
    - `UPPER(str)` - преобразует строку `str` в верхний регистр.
    - `LOWER(str)` - преобразует строку `str` в нижний регистр.
    - `SUBSTRING(str FROM start FOR length)` - возвращает подстроку из строки `str` начиная с позиции `start` и
      длиной `length`.

2. **Функции для работы с датами и временем:**
    - `NOW()` - возвращает текущую дату и время.
    - `EXTRACT(field FROM source)` - извлекает часть времени или даты из `source` (
      например, `EXTRACT(YEAR FROM date_column)`).
    - `AGE(end, start)` - возвращает разницу между двумя датами в виде интервала.

3. **Числовые функции:**
    - `ABS(x)` - возвращает абсолютное значение числа `x`.
    - `ROUND(x)` - возвращает число `x`, округленное до ближайшего целого.
    - `POWER(x, y)` - возвращает x в степени y.
    - `RANDOM()` - возвращает случайное число от 0 до 1.

4. **Функции для работы с массивами:**
    - `ARRAY_LENGTH(arr, dimension)` - возвращает длину массива `arr` в указанном измерении.
    - `ARRAY_APPEND(arr, value)` - добавляет значение `value` в конец массива `arr`.

5. **Логические функции:**
    - `AND`, `OR`, `NOT` - логические операторы для комбинирования условий.
    - `CASE` - условное выражение, аналогичное оператору `switch` в других языках программирования.

6. **Географические и геометрические функции:**
    - `ST_DISTANCE(geom1, geom2)` - возвращает расстояние между двумя геометрическими объектами.
    - `ST_INTERSECTS(geom1, geom2)` - проверяет, пересекаются ли два геометрических объекта.

7. **Функции для работы с JSON и JSONB:**
    - `->` и `->>` - для извлечения значений из JSON-объекта.
    - `json_agg` - для агрегации значений в формате JSON.

Это всего лишь несколько примеров встроенных функций PostgreSQL. С полным списком и подробной информацией по каждой
функции рекомендуется обратиться к официальной документации PostgreSQL.

## Использовать различные типы данных PostgreSQL;

PostgreSQL поддерживает разнообразные типы данных для хранения различных видов информации. Вот некоторые из наиболее
распространенных типов данных в PostgreSQL:

1. **Целочисленные типы данных:**
    - `smallint` - 2-байтовое целое число.
    - `integer` - 4-байтовое целое число.
    - `bigint` - 8-байтовое целое число.

   Пример:
   ```sql
   CREATE TABLE example_table (
       id serial PRIMARY KEY,
       smallint_col smallint,
       integer_col integer,
       bigint_col bigint
   );
   ```

2. **Вещественные типы данных:**
    - `real` - 4-байтовое вещественное число (одинарной точности).
    - `double precision` - 8-байтовое вещественное число (двойной точности).

   Пример:
   ```sql
   CREATE TABLE example_table (
       id serial PRIMARY KEY,
       real_col real,
       double_col double precision
   );
   ```

3. **Текстовые типы данных:**
    - `character(n)` - фиксированная длина строки.
    - `varchar(n)` - переменная длина строки.
    - `text` - текстовый тип данных переменной длины (без ограничения длины).

   Пример:
   ```sql
   CREATE TABLE example_table (
       id serial PRIMARY KEY,
       char_col character(50),
       varchar_col varchar(255),
       text_col text
   );
   ```

4. **Дата и время:**
    - `timestamp` - дата и время.
    - `date` - только дата.
    - `time` - только время.

   Пример:
   ```sql
   CREATE TABLE example_table (
       id serial PRIMARY KEY,
       timestamp_col timestamp,
       date_col date,
       time_col time
   );
   ```

5. **Булев тип данных:**
    - `boolean` - логический тип данных.

   Пример:
   ```sql
   CREATE TABLE example_table (
       id serial PRIMARY KEY,
       bool_col boolean
   );
   ```

6. **Массивы:**
    - `integer[]` - массив целых чисел.

   Пример:
   ```sql
   CREATE TABLE example_table (
       id serial PRIMARY KEY,
       int_array integer[]
   );
   ```

7. **JSON и JSONB:**
    - `json` - для хранения данных в формате JSON.
    - `jsonb` - для хранения бинарных JSON данных с более эффективным индексированием.

   Пример:
   ```sql
   CREATE TABLE example_table (
       id serial PRIMARY KEY,
       json_col json,
       jsonb_col jsonb
   );
   ```

Это лишь небольшой обзор типов данных в PostgreSQL. Существует множество других типов данных и возможностей, таких как
географические типы, бинарные типы данных, и другие. При создании таблицы в PostgreSQL важно выбирать подходящие типы
данных для вашей конкретной задачи.

## Создать свои типы данных;

В PostgreSQL вы можете создавать свои собственные пользовательские типы данных с использованием команды `CREATE TYPE`.
Это может быть полезно, например, когда вам нужно создать структурированный тип данных для хранения информации
определенного формата. Вот пример создания пользовательского типа данных:

```sql
-- Создаем перечисление (enum) с именем 'status'
CREATE TYPE status AS ENUM ('active', 'inactive', 'pending');

-- Создаем тип данных с именем 'employee'
CREATE TYPE employee AS (
    id INT,
    name VARCHAR(100),
    department VARCHAR(50),
    status status
);

-- Создаем таблицу, используя пользовательский тип данных 'employee'
CREATE TABLE employees (
    employee_data employee
);

-- Вставляем данные в таблицу
INSERT INTO employees VALUES (ROW(1, 'John Doe', 'IT', 'active'));

-- Выбираем данные из таблицы
SELECT * FROM employees;
```

В этом примере создается пользовательский тип данных `status` в виде перечисления, а затем создается тип
данных `employee` с использованием этого перечисления. Затем создается таблица `employees`, где одним из столбцов
является тип `employee`. Данные вставляются в таблицу с использованием нового типа данных.

Важные замечания:

- **Перечисления (ENUM):** Это ограниченный набор допустимых значений. В приведенном выше примере `status` - это
  перечисление, которое может содержать только значения 'active', 'inactive' или 'pending'.

- **Тип данных ROW:** В данном примере используется тип `employee`, который является составным типом (`ROW`), содержащим
  несколько полей.

- **Рекурсивные типы данных:** PostgreSQL также поддерживает создание рекурсивных пользовательских типов данных.

Прежде чем создавать свои типы данных, обязательно подумайте о структуре данных и том, как они будут использоваться в
вашей базе данных. Создание пользовательских типов данных может упростить схему базы данных и улучшить читаемость
запросов, но это также может усложнить миграции данных и поддержку, поэтому оцените, насколько это необходимо в вашем
конкретном случае.